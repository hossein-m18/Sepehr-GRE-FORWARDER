## ุฑุงู ุงูุฏุงุฒ ู ูุฏุฑุช ุขุณุงู ุชุงูู GRE + TCP FORWARDER

ุงุณฺฉุฑูพุช ุณูพูุฑ ุจุฑุง ุฑุงูโุงูุฏุงุฒ ู ูุฏุฑุช ุณุฑุน ู ุขุณุงู ุชููู GRE ู ูพูุฑุช ููุฑุงุฑุฏ ฺฉู ูุชูุงู ุจู ฺฉ ุง ฺูุฏ ุณุฑูุฑ ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉุฑุฏุ ุจุง ุงุฏ ุฌุงู ูุฏุง ูููุ ุณูพูุฑ ุนุฒุฒ (ุณูพูุฑ ฺฉุฌุง ุจุงุจุงุ)

<img width="842" height="507" alt="image" src="https://github.com/user-attachments/assets/2cb49af2-61cb-4755-9b62-50b8f1c47042" />

## ๐ ูุตุจ ู ุงุฌุฑุง

Socat Forwarder

    wget -4 -O sepehr.sh "https://raw.githubusercontent.com/hossein-m18/Sepehr-GRE-FORWARDER/main/sepehr.sh?$(date +%s)" && chmod +x sepehr.sh && bash sepehr.sh

HAProxy Forwarder

    wget -4 -O sepehr-haproxy.sh "https://raw.githubusercontent.com/hossein-m18/Sepehr-GRE-FORWARDER/refs/heads/main/sepehr-haproxy.sh?$(date +%s)" && chmod +x sepehr-haproxy.sh && bash sepehr-haproxy.sh

## ๐งญ ุณุงุฎุชุงุฑ ููู

## ุชูุธูุงุช ุณุฑูุฑ ุฎุงุฑุฌ 2) KHAREJ SETUP

ุงุจุชุฏุง ุฏุฑ ุณุฑูุฑ ุฎุงุฑุฌ ุงุณฺฉุฑูพุช ุฑุง ุงุฌุฑุง ฺฉูุฏ.

ุจู ุณูุงูุงุช ุจู ุชุฑุชุจ ูพุงุณุฎ ุฏูุฏ.

1. ุฏุฑ GRE Number > ููุธูุฑ ุดูุงุฑู GRE ุงุณุช ฺฉ ุนุฏุฏ ุจู 1 ุชุง 9 ุงูุชุฎุงุจ ฺฉูุฏุ ุฏุฑ ูุฑ ุฏู ุณุฑูุฑ ฺฉุณุงู ุจุงุดุฏ.
2. ุง ูพ ุณุฑูุฑ ุฎุงุฑุฌ ุฑุง ูุงุฑุฏ ฺฉูุฏ
3. ุง ูพ ุณุฑูุฑ ุงุฑุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ
4. ฺฉ ุง ูพ ูพุฑุงูุช ุงูุชุฎุงุจ ฺฉูุฏุ ูุซูุง 10.245.245.0 ุ ุฏุฑ ูุฑ ุฏู ุณุฑูุฑ ฺฉุณุงู ุจุงุดุฏ.
5. ุฏุฑ ุตูุฑุช ูุงุฒ ุจู MTU ุฏูุฎูุงู y ุฑุง ูุงุฑุฏ ฺฉูุฏ ู ุณูพุณ ุนุฏุฏ MTU ูุฏ ูุธุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ

## ุชูุธูุงุช ุณุฑูุฑ ุงุฑุงู 1) IRAN SETUP

1. ุฏุฑ GRE Number > ููุงู ฺฉู ุฏุฑ ุฎุงุฑุฌ ุฒุฏุฏ ุฑุง ุงูุฌุง ูุงุฑุฏ ฺฉูุฏ.
2. ุง ูพ ุณุฑูุฑ ุงุฑุงู ุฑุง ูุงุฑุฏ ฺฉูุฏ.
3. ุง ูพ ุณุฑูุฑ ุฎุงุฑุฌ ุฑุง ูุงุฑุฏ ฺฉูุฏ.
4. ฺฉ ุง ูพ ูพุฑุงูุช ุงูุชุฎุงุจ ฺฉูุฏุ ูุดุงุจู ููุงู ฺฉู ุณูุช ุฎุงุฑุฌ ูุงุฑุฏ ฺฉุฑุฏุฏ.
5. ูพูุฑุช ูุง ูพูู ู ุงูุจุงูุฏ (ูุฑูพูุฑุช ฺฉู ูุงุฒ ุจู ุชุงูู ุขู ุฏุงุฑุฏ) ุฑุง ูุงุฑุฏ ฺฉูุฏุ ูุซูุง 2052,2053 ุง ุจุฑุง ุฑูุฌ ุฎุงุต 2050-2060 ุฑุง ูุงุฑุฏ ฺฉูุฏ
6. ุฏุฑ ุตูุฑุช ูุงุฒ ุจู MTU ุฏูุฎูุงู y ุฑุง ูุงุฑุฏ ฺฉูุฏ ู ุณูพุณ ุนุฏุฏ MTU ูุฏ ูุธุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ

## ฺฏุฒูู 6 > Rebuild Automation

ุงู ูุงุจูุช ุจู ุดูุง ุงู ุงูฺฉุงู ุฑู ูุฏู ุชุง ุจุง ุชูุธู ฺฉุฑูู ุฏุฑ ุณุงุนุช ุฎุงุต ูุฏ ูุธุฑ ุฎูุฏุชูู ุจุง ุงุณุชูุงุฏู ุงุฒ ุชูุธูุงุช ฺฉู ูุจูุง ุงูุฌุงู ุฏุงุฏุฏ ุ ุชุงูู ูุนู ุงุณุชุงูพุุบุฑูุนุงู ู ุญุฐู ูุดูุฏ ู ูุฌุฏุฏ ุจุง ููุงู ููุงุฏุฑ ูุจู ุจุฑุง ุดูุง GRE ู ุชุงูู ุงูุฌุงู ูุฏูุฏ. ( ูุดุงุจู ุงู ุงุณุช ฺฉู ุขูุณุชุงู ู ูุฌุฏุฏ ุชุงูู ุฑู ุงุฌุงุฏ ฺฉุฑุฏุฏ)

## ฺฏุฒูู 7 > Regenerate Automation

ุงู ูุงุจูุช ุจู ุดูุง ุงู ุงูฺฉุงู ุฑู ูุฏู ุชุง ุจุง ุชูุธู ฺฉุฑูู ุฏุฑ ุณุงุนุช ุฎุงุต ูุฏ ูุธุฑ ุฎูุฏุชูู ุชูุธูุงุช GRE ุฑู ุฑุณุช ฺฉูุฏุ ุงู ูุงุจูุช ุฏุฑ ุณุงุนุช ุชุนู ุดุฏู ุนูุงูู ุจุฑ ุฑุณุช ุณุฑูุณ ูุง IP GRE ุดูุง ุฑู ุชุบุฑ ูุฏู ู ุง ูพ ุฌุฏุฏ ุงุชููุงุชฺฉ ุฏุฑ ูุฑ ุฏู ุณูุช ุณุช ูฺฉููุ ุงู ูุงุจูุช ุจุฑุง ุฏูุณุชุงู ฺฉู ูุดฺฉู ุฏุฑ ุฏุฑุงูพ ุดุฏู GRE ู ุฑูุฌุดูู ูุฑ ฺูุฏ ุณุงุนุช ุฏุงุดุชูุฏ ุงุถุงูู ุดุฏูุ ูพุณ ุดูุง ููุท ุงฺฏุฑ ุงู ูุดฺฉู ุฑู ุฏุฑ ุดุจฺฉู ุฎูุฏุชูู ุฏุงุฑุฏ ุงุฒ ุงู ูุงุจูุช ุงุณุชูุงุฏู ฺฉูุฏ.

## ฺฏุฒูู 8 > Change MTU

ุจุฑุง ุชุบุฑ MTU ูุชูุงูุฏ ุงุฒ ุงู ฺฏุฒูู ุงุณุชูุงุฏู ฺฉูุฏ.

## ุงุถุงูู ฺฉุฑุฏู ูพูุฑุช ุฌุฏุฏ 5 > add tunnel port

ุจุฑุง ุงุถุงูู ฺฉุฑุฏู ูพูุฑุช ุฌุฏุฏ ฺฏุฒูู 5 ู ุณูพุณ ุงูุชุฎุงุจ ุดูุงุฑู GRE ูุฏ ูุธุฑ ุฎูุฏุชูู ู ุชููุฏ ูพูุฑุช ุฌุฏุฏ ุฑู ุงุถุงูู ฺฉูุฏ.

## ูุฏุฑุช ุณุฑูุณ ูุง 3) Services ManageMent

ุงุฒ ูุณุช GRE ูุฏ ูุธุฑ ุฎูุฏ ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ ู ุจุฑุง ูุฏุฑุช ูพูุฑุช ูุง ููุฑูุงุฑุฏ ุดุฏู ุงุฒ Forward ุงุณุชูุงุฏู ฺฉูุฏ.

## ูฺฉุชู

ุฏุฑ ุงู ุงุณฺฉุฑูพุช TCP ููุฑูุงุฑุฏ ุงูุฌุงู ูุดูุฏุ ุงฺฏุฑ ูุงุฒ ุจู ููุฑูุงุฑุฏ ูพูุฑุช UDP ุฏุงุฑุฏ ุงุฒ ูุฑฺู Socat ุงุณุชูุงุฏู ฺฉูุฏ.

ุจุนุฏ ุงุฒ ุงูุฌุงู ูุฑุงุญู ุชุงูููฺฏ ุจุง ุฏุณุชูุฑ

    ls -la /etc/systemd/system | grep -E 'gre[0-9]+\.service|fw-gre'

ูุณุช ุณุฑูุณ ูุง ุณุงุฎุชู ุดุฏู ุฑู ุฏุฑุงูุช ฺฉูุฏ.

ุณูพุณ ูุฑ ุณุฑูุณ ุจุง fw-gre\* ุฑุง ูุฑุงุด ฺฉูุฏ.

ูุซูุง ุจุฑุง ูพูุฑุช 80 ู gre1 ุจู ุงู ุดฺฉู ุงุณุช.

ูุงู /etc/systemd/system/fw-gre1-80.service ุฑุง ุจุง ูุฑุงุดฺฏุฑ ุจุงุฒ ูฺฉูุฏ ู ุฏุฑ ุฎุท ExecStart ููุงุฏุฑ TCP ุฑุง ุจู UDP ุชุบุฑ ุฏูุฏ

ู ุฏุฑ ุงูุชูุง systemctl daemon-reload ู systemctl restart fw-gre\* ุฑุง ุจุฒูุฏ.

## ุญุฏู ู ูพุงฺฉุณุงุฒ 4) Unistall & Clean

ุงุฒ ุงู ููู ูุชูุงูุฏ ุจุฑุง ุญุฐู ู ูพุงฺฉุณุงุฒ ุชุงูู ูุง ุณุงุฎุชู ุดุฏู ุงุณุชูุงุฏู ฺฉูุฏ

## ูุณุช ุณุฑูุณ ูุง ู ูุงฺฏ ูุง

ุจุฑุง ุฏุฑุงูุช ูุณุช ุณุฑูุณ ูุง ุจู ุตูุฑุช ุฏุณุช ุงุฒ ls -la /etc/systemd/system | grep -E 'gre[0-9]+\.service|fw-gre' ุงุณุชูุงุฏู ฺฉูุฏ.

ูุงฺฏ ูุฑุจูุท ุจู ฺฉุฑูู ุฏุฑ ูุณุฑ ู ูุงู /var/log/sepehr-greID.log ูุฌูุฏ ุฏุงุฑุฏ.(ุจู ุฌุง ID ุดูุงุฑู GRE ูุฑุงุฑ ูฺฏุฑุฏ) ุจุฑุง ูุดุงูุฏู ูุงฺฏ ฺฉุฑูู GRE ุดูุงุฑู 1 ุจุฑุง ูุซุงู cat /var/log/sepehr-gre1.log ุฑุง ูุงุฑุฏ ฺฉูุฏ.

## ุญูุงุช

ุฌูุช ุญูุงุช ููุท ุจุฑุง ุขุฑุงูุด ุฑูุญ ูพุงฺฉ ุณูพูุฑ ุนุฒุฒ ู ุชูุงู ุนุฒุฒุงู ุฌุงู ูุฏุง ุงูููุงุจ ุฏ 1404 ุงุฑุงู ุนุฒุฒูุงู ุฏุนุง ฺฉูุฏ
